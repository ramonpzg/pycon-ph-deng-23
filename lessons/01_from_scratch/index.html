
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="3-hour workshop presented at PyCon Philippines 2023">
      
      
        <meta name="author" content="Ramon Perez">
      
      
        <link rel="canonical" href="https://ramonpzg.github.io/pycon-ph-deng-23/lessons/01_from_scratch/">
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../../resources/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.1.1">
    
    
      
        <title>Data Engineering from Scratch - Data Engineering Workshop - PyCon PH 2023</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.402914a4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="pink" data-md-color-accent="deep-purple">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#01-data-pipelines-from-scratch" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Data Engineering Workshop - PyCon PH 2023" class="md-header__button md-logo" aria-label="Data Engineering Workshop - PyCon PH 2023" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Data Engineering Workshop - PyCon PH 2023
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Data Engineering from Scratch
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="pink" data-md-color-accent="deep-purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
            </label>
          
        
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="red" data-md-color-accent="red"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ramonpzg/pycon-ph-deng-23" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    RPG Content
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../setup/" class="md-tabs__link">
        Set Up
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../data/indext.md" class="md-tabs__link">
        Data
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../" class="md-tabs__link md-tabs__link--active">
        Lessons
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../resources/" class="md-tabs__link">
      Resources
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Data Engineering Workshop - PyCon PH 2023" class="md-nav__button md-logo" aria-label="Data Engineering Workshop - PyCon PH 2023" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Data Engineering Workshop - PyCon PH 2023
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ramonpzg/pycon-ph-deng-23" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    RPG Content
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../setup/">Set Up</a>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Set Up
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Data
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Data
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../data/indext.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
      
      
        
          
            
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../">Lessons</a>
          
            <label for="__nav_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Lessons
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Data Engineering from Scratch
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Data Engineering from Scratch
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#01-data-pipelines-from-scratch" class="md-nav__link">
    01 Data Pipelines From Scratch
  </a>
  
    <nav class="md-nav" aria-label="01 Data Pipelines From Scratch">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    Table of Contents
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-overview" class="md-nav__link">
    1. Overview
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-learning-outcomes" class="md-nav__link">
    2. Learning Outcomes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-data" class="md-nav__link">
    3. Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-tools" class="md-nav__link">
    4. Tools
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-data-pipelines" class="md-nav__link">
    5. Data Pipelines
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-building-a-framework" class="md-nav__link">
    6. Building a Framework
  </a>
  
    <nav class="md-nav" aria-label="6. Building a Framework">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-setting-up-a-dev-environment" class="md-nav__link">
    6.1 Setting Up a Dev Environment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-extract" class="md-nav__link">
    6.2 Extract
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63-transform" class="md-nav__link">
    6.3 Transform
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise" class="md-nav__link">
    Exercise
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-load" class="md-nav__link">
    6.2 Load
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-reproducible-pipelines" class="md-nav__link">
    7. Reproducible Pipelines
  </a>
  
    <nav class="md-nav" aria-label="7. Reproducible Pipelines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise_1" class="md-nav__link">
    Exercise
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-scheduling" class="md-nav__link">
    8. Scheduling
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9-exercises" class="md-nav__link">
    9. Exercises
  </a>
  
    <nav class="md-nav" aria-label="9. Exercises">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-1" class="md-nav__link">
    Exercise 1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-2" class="md-nav__link">
    Exercise 2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10-resources" class="md-nav__link">
    10. Resources
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../resources/" class="md-nav__link">
        Resources
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#01-data-pipelines-from-scratch" class="md-nav__link">
    01 Data Pipelines From Scratch
  </a>
  
    <nav class="md-nav" aria-label="01 Data Pipelines From Scratch">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    Table of Contents
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-overview" class="md-nav__link">
    1. Overview
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-learning-outcomes" class="md-nav__link">
    2. Learning Outcomes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-data" class="md-nav__link">
    3. Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-tools" class="md-nav__link">
    4. Tools
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-data-pipelines" class="md-nav__link">
    5. Data Pipelines
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-building-a-framework" class="md-nav__link">
    6. Building a Framework
  </a>
  
    <nav class="md-nav" aria-label="6. Building a Framework">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-setting-up-a-dev-environment" class="md-nav__link">
    6.1 Setting Up a Dev Environment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-extract" class="md-nav__link">
    6.2 Extract
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63-transform" class="md-nav__link">
    6.3 Transform
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise" class="md-nav__link">
    Exercise
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-load" class="md-nav__link">
    6.2 Load
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-reproducible-pipelines" class="md-nav__link">
    7. Reproducible Pipelines
  </a>
  
    <nav class="md-nav" aria-label="7. Reproducible Pipelines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise_1" class="md-nav__link">
    Exercise
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-scheduling" class="md-nav__link">
    8. Scheduling
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9-exercises" class="md-nav__link">
    9. Exercises
  </a>
  
    <nav class="md-nav" aria-label="9. Exercises">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-1" class="md-nav__link">
    Exercise 1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-2" class="md-nav__link">
    Exercise 2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10-resources" class="md-nav__link">
    10. Resources
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>Data Engineering from Scratch</h1>

<h2 id="01-data-pipelines-from-scratch">01 Data Pipelines From Scratch<a class="headerlink" href="#01-data-pipelines-from-scratch" title="Permanent link">&para;</a></h2>
<blockquote>
<p>‚ÄúWithout a systematic way to start and keep data clean, bad data will happen.‚Äù ~ Donato Diorio</p>
</blockquote>
<p><img alt="flow" src="https://drawio-app.com/wp-content/uploads/2019/05/How-to-create-flow-charts-in-drawio-1-1.png" /><br />
Source: <a href="https://drawio-app.com/flowcharts/">draw.io</a></p>
<h3 id="table-of-contents">Table of Contents<a class="headerlink" href="#table-of-contents" title="Permanent link">&para;</a></h3>
<ol>
<li><a href="##1.-Overview">Overview</a></li>
<li><a href="##2.-Learning-Outcomes">Learning Outcomes</a></li>
<li><a href="##3.-Data">Data</a></li>
<li><a href="##4.-Tools">Tools</a></li>
<li><a href="##5.-Data-Pipelines">Data Pipelines</a></li>
<li><a href="##6.-Building-a-Framework">Building a Framework</a><ul>
<li>Set Up Dev Environment</li>
<li>Extract</li>
<li>Transform</li>
<li>Load</li>
</ul>
</li>
<li><a href="##7.-Reproducible-Pipelines">Reproducible Pipelines</a></li>
<li><a href="##8.-Scheduling">Scheduling</a></li>
<li><a href="##9.-Exercises">Exercises</a></li>
<li><a href="##10.-Resources">Resources</a></li>
</ol>
<h3 id="1-overview">1. Overview<a class="headerlink" href="#1-overview" title="Permanent link">&para;</a></h3>
<p>In order to create successful and reproducible data pipelines we need -- at the bare minimum -- tools that allow us manage where and how we store our data, how we run our computations, and how we version control everything we do. This is what we will focus on in this part of the workshop.</p>
<p>The assumption of this section is that most of your data work can fit in a computer but, if the need were to arise, you could still use the code in this section with a beefier machine and it would get the job done without a problem.</p>
<p>Since the files we'll interact with will most likely live in a remote server, we'll 
1. extract a copy of the data we'll use and save it to our local files;
2. transform the data into the shape and form we need it to be in;
3. load it into a local data warehouse based on the popular tool, duckdb;
4. version our code and data using dvc and git;
5. create a command line tool to run all of our jobs;
6. create a reproducible pipeline that can capture different workflows.</p>
<p>Before we get started, let's go over the learning outcomes for today. :)</p>
<p>Note: While one of the main components of data orchestration is scheduling, you can sill create pipelines and reproducible workflows that can be triggered manually rather than via a schedule.</p>
<h3 id="2-learning-outcomes">2. Learning Outcomes<a class="headerlink" href="#2-learning-outcomes" title="Permanent link">&para;</a></h3>
<p>Before we get started, let's go over the learning outcomes for this section of the workshop.</p>
<p>By the end of this lesson you will be able to,
1. Discuss what ETL and ELT Pipelines are.
2. Understand how to read and combine data that comes from different sources.
3. Create data pipelines using open-source tools.
4. Develop command line tools.</p>
<h3 id="3-data">3. Data<a class="headerlink" href="#3-data" title="Permanent link">&para;</a></h3>
<p><img alt="bikes" src="https://upload.wikimedia.org/wikipedia/commons/2/20/Bike_share.jpg" /></p>
<p>All three data files contain similar information about how many bicycles have been rented each hour, day, week and months for several years and for each city government we are working with.</p>
<p>You can get more information about the data of each city using the following links.</p>
<ul>
<li><a href="https://archive.ics.uci.edu/ml/datasets/Seoul+Bike+Sharing+Demand#">Seoul, South Korea</a></li>
<li><a href="https://www.kaggle.com/hmavrodiev/london-bike-sharing-dataset">London, England, UK</a></li>
<li><a href="https://www.kaggle.com/marklvl/bike-sharing-dataset?select=hour.csv">Washington, DC, USA</a></li>
<li><a href="https://www.kaggle.com/datasets/imakash3011/rental-bike-sharing">Porto, Portugal</a> -- This one was shared in Kaggle, but you can also find the original source with more, up-to-date data, <a href="https://capitalbikeshare.com/system-data">here</a>.</li>
</ul>
<p>Note: Some datasets might come with another file containing daily information, but for our purposes, we will be using the hourly one.</p>
<p>Here are the variables that appear in all data sets.</p>
<table>
<thead>
<tr>
<th align="center">London</th>
<th align="center">Seoul</th>
<th align="center">Washington</th>
<th align="center">Porto</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">date</td>
<td align="center">Date</td>
<td align="center">instant</td>
<td align="center">instant</td>
</tr>
<tr>
<td align="center">count</td>
<td align="center">Rented Bike Count</td>
<td align="center">date</td>
<td align="center">dteday</td>
</tr>
<tr>
<td align="center">temperature</td>
<td align="center">Hour</td>
<td align="center">seasons</td>
<td align="center">season</td>
</tr>
<tr>
<td align="center">t2</td>
<td align="center">Temperature(C)</td>
<td align="center">year</td>
<td align="center">yr</td>
</tr>
<tr>
<td align="center">humidity</td>
<td align="center">Humidity(%)</td>
<td align="center">month</td>
<td align="center">mnth</td>
</tr>
<tr>
<td align="center">wind_speed</td>
<td align="center">Wind speed (m/s)</td>
<td align="center">hour</td>
<td align="center">hr</td>
</tr>
<tr>
<td align="center">weather_code</td>
<td align="center">Visibility  (10m)</td>
<td align="center">is_holiday</td>
<td align="center">holiday</td>
</tr>
<tr>
<td align="center">is_holiday</td>
<td align="center">Dew point temperature(√Ø¬ø¬ΩC)</td>
<td align="center">weekday</td>
<td align="center">weekday</td>
</tr>
<tr>
<td align="center">is_weekend</td>
<td align="center">Solar Radiation (MJ/m2)</td>
<td align="center">workingday</td>
<td align="center">workingday</td>
</tr>
<tr>
<td align="center">seasons</td>
<td align="center">Rainfall(mm)</td>
<td align="center">weathersit</td>
<td align="center">weathersit</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">Snowfall(cm)</td>
<td align="center">temperature</td>
<td align="center">temp</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">Seasons</td>
<td align="center">count</td>
<td align="center">atemp</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">Holiday</td>
<td align="center">humidity</td>
<td align="center">hum</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">Functioning Day</td>
<td align="center">wind_speed</td>
<td align="center">windspeed</td>
</tr>
<tr>
<td align="center"></td>
<td align="center"></td>
<td align="center">casual</td>
<td align="center">casual</td>
</tr>
<tr>
<td align="center"></td>
<td align="center"></td>
<td align="center">registered</td>
<td align="center">registered</td>
</tr>
<tr>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">cnt</td>
</tr>
</tbody>
</table>
<p>Since all of these datasets were generated with different logic (e.g. celsius vs fahrenheit, or other divergent measures) and, most likely, by different systems, we can expect more inconsistencies than just unmatching column names, numerical formats, and data collected.</p>
<p>We will walk through an example pipeline and several cleaning steps after we discuss the tools we will be using today.</p>
<h3 id="4-tools">4. Tools<a class="headerlink" href="#4-tools" title="Permanent link">&para;</a></h3>
<p>The tools that we will use in this section of the workshop are the following.</p>
<ul>
<li><a href="https://pandas.pydata.org/">pandas</a> - "is a fast, powerful, flexible and easy to use open source data analysis and manipulation tool, built on top of the Python programming language."</li>
<li><a href="https://dvc.org/">dvc</a> - "DVC is built to make ML models shareable and reproducible. It is designed to handle large files, data sets, machine learning models, and metrics as well as code."</li>
<li><a href="https://ibis-project.org/">ibis</a> - "Ibis is a Python library that provides a lightweight, universal interface for data wrangling. It helps Python users explore and transform data of any size, stored anywhere."</li>
<li><a href="https://typer.tiangolo.com/">typer</a> - "Typer is a library for building CLI applications that users will love using and developers will love creating. Based on Python 3.6+ type hints."</li>
<li><a href="https://docs.python.org/3/library/pathlib.html">pathlib</a> - allows us to manipulate paths as if they were python objects.</li>
</ul>
<p>Let's get started building data pipelines! :)</p>
<h3 id="5-data-pipelines">5. Data Pipelines<a class="headerlink" href="#5-data-pipelines" title="Permanent link">&para;</a></h3>
<p><img alt="etl_pipe" src="https://editor.analyticsvidhya.com/uploads/899101.png" /><br />
Source: <a href="https://www.striim.com/">Striim</a></p>
<p>There are different kinds of data pipelines, but two, in particular, dominate a big part of the data engineering world today, ETL and ELT pipelines.</p>
<p><strong>What are ETL Pipelines?</strong></p>
<p>The acronym ETL stands for Extract, Transform, and Load, and it is the process where data gets extracted from one or multiple sources, it gets processed in-transit, and then it gets loaded into place where data consumers can use (e.g. a data warehouse). These consumers can be data analysts, data scientists, and machine learning engineers, among many others.</p>
<p><strong>What are ELT Pipelines?</strong>
With this approach, all the data, structured and unstructured, gets loaded into a data lake or warehouse before it gets transformed. With this approach, a lot of money spent on compute can be saved by only processing the data we need rather than all of it.</p>
<p><strong>What are Reverse ETL Pipelines?</strong>
Reverse ETL tools take data from the data lake or warehouse back into business (critical) applications. For example, information about new customers that have not yet been populated into salesforce or other marketing tools for further use by the marketing, sales, and finance teams, and so on...</p>
<p><strong>Why should you learn how to create them?</strong></p>
<p>Data Pipeline tools enable data integration strategies by allowing companies to gather data from multiple data sources and consolidate it into a single, centralized location. ETL tools also make it possible for different types of data to work together, for example, data generated by the company can be combined with GPS and Temperature data coming from different sources.</p>
<p>As data professionals, our task is to create value for our organizations, our clients and our collaborators using some of or all the data at our disposal. However, there are factors that can delay this process a little bit or a lot, for example, we often need to understand beforehand,
1. Information about the process by which the data we're dealing with was generated, e.g.
    - Point of sale
    - Clicks on an online marketplace like Amazon, Etzy, Ebay, ect.
    - A/B Test Results
    - ...
2. Information about the transformations that occurred during the cleaning and merging process, prior to us jumping on board,
    - Celsius degrees were converted into fahrenheit
    - Prices in Chilean pesos were converted to Rands
    - Non-numerical and unavailable observations now contain "Not Available" or "Unknown"
    - ...
3. Information about how the data was stored and where. For instance,
    - Parquet format
    - NOSQL or SQL database
    - CSV
    - ...</p>
<p>Understanding how the three processes described above flow will help us have more knowledge about the data that we are going to use, and how to best access it, transform it, and model it before we put it to good use.</p>
<p>Let's walk through an example of a data pipeline using data from wildfires between 1983-2020 in the United States. You can find more information about the dataset <a href="https://www.kaggle.com/kkhandekar/total-wildfires-acres-affected-1983-2020">here</a>.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="err">!</span><span class="n">pwd</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>/home/ramonperez/Tresors/datascience/tutorials/ph_pycon23/notebooks
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">data_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">()</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="o">/</span><span class="s2">&quot;data&quot;</span>
<span class="n">data_path</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>PosixPath(&#39;/home/ramonperez/Tresors/datascience/tutorials/ph_pycon23/data&#39;)
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">example_data_in</span> <span class="o">=</span> <span class="n">data_path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;example&quot;</span><span class="p">,</span> <span class="s2">&quot;federal_firefighting_costs.csv&quot;</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">example_data_in</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Year</th>
      <th>Fires</th>
      <th>Acres</th>
      <th>ForestService</th>
      <th>DOIAgencies</th>
      <th>Total</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1985</td>
      <td>82,591</td>
      <td>2,896,147</td>
      <td>$161,505,000</td>
      <td>$78,438,000</td>
      <td>$239,943,000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1986</td>
      <td>85,907</td>
      <td>2,719,162</td>
      <td>$111,625,000</td>
      <td>$91,153,000</td>
      <td>$202,778,000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1987</td>
      <td>71,300</td>
      <td>2,447,296</td>
      <td>$253,657,000</td>
      <td>$81,452,000</td>
      <td>$335,109,000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1988</td>
      <td>72,750</td>
      <td>5,009,290</td>
      <td>$429,609,000</td>
      <td>$149,317,000</td>
      <td>$578,926,000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1989</td>
      <td>48,949</td>
      <td>1,827,310</td>
      <td>$331,672,000</td>
      <td>$168,115,000</td>
      <td>$499,787,000</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">example_data_in</span><span class="p">)</span><span class="o">.</span><span class="n">dtypes</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code>Year              int64
Fires            object
Acres            object
ForestService    object
DOIAgencies      object
Total            object
dtype: object
</code></pre></div></td></tr></table></div>
<p>As you can see, most columns contain a <code>$</code> dollar sign and some <code>,</code> commas, and because this forces Python to treat numbers as objects (or strings) rather than <code>int</code>'s or <code>float</code>'s, we will have to remove these signs in our transformation step after extracting the data and before loading a clean version of it to a new location. Let's create 3 re-usable functions.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>As you saw above, only the last 5 variables have commas (<code>,</code>) and dollar symbols (<code>$</code>) so we will replace both with an empty space (<code>""</code>) using a <code>for</code> loop.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^0-9]+&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
<p>For the "load" process, we will save the data as a <code>parquet</code> file. This is one of the most popular formats to save data in due to its compression capabilities, orientation, and speed gains in analytical workloads.</p>
<p>Here's an example on the differences between the row-like format and the columnar format of parquet files. If this interests you you can read more about it <a href="https://datos.gob.es/en/blog/why-should-you-use-parquet-files-if-you-process-lot-data">here</a></p>
<p><img alt="colvsrow" src="https://www.scylladb.com/wp-content/uploads/columnar-database-diagram.png" /><br />
Source: <a href="https://www.scylladb.com/glossary/columnar-database/">Scylla DB</a></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
    <span class="n">data</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Successfully Loaded Your Modified Data!&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>Let's create an output path and with a file name to save our data as.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">data_path</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>PosixPath(&#39;/home/ramonperez/Tresors/datascience/tutorials/ph_pycon23/data&#39;)
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">example_data_out</span> <span class="o">=</span> <span class="n">data_path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;example&quot;</span><span class="p">,</span> <span class="s2">&quot;my_test.parquet&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>When we have all the steps ready, we create a new function containing our graph using the <code>flow</code> decorator. We can give this function a name, for example, <code>"Example Pipeline! üòé"</code> and then chain the tasks we created previously in the order in which they should be run.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">example_etl</span><span class="p">(</span><span class="n">example_data_in</span><span class="p">,</span> <span class="n">example_data_out</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">extract</span><span class="p">(</span><span class="n">example_data_in</span><span class="p">)</span>
    <span class="n">data_clean</span> <span class="o">=</span> <span class="n">transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">load</span><span class="p">(</span><span class="n">data_clean</span><span class="p">,</span> <span class="n">example_data_out</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Your Pipeline Ran Successfully!&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>We are ready to run our workflow.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">example_etl</span><span class="p">(</span><span class="n">example_data_in</span><span class="p">,</span> <span class="n">example_data_out</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>Successfully Loaded Your Modified Data!
Your Pipeline Ran Successfully!
</code></pre></div></td></tr></table></div>
<p>To make sure we did everything correctly, let's create a quick visualization with pandas.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">example_data_out</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;ForestService&quot;</span><span class="p">,</span> 
    <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Forest Service costs by year&quot;</span>
<span class="p">);</span>
</code></pre></div></td></tr></table></div>
<p><img alt="png" src="../docs/lessons/01_from_scratch_files/../docs/lessons/01_from_scratch_33_0.png" /></p>
<h3 id="6-building-a-framework">6. Building a Framework<a class="headerlink" href="#6-building-a-framework" title="Permanent link">&para;</a></h3>
<p>In order to do our data engineering work with a personalized framework, there are a few strategies we would take.
- We could keep the code in our computers and copy it to a new project whenever we need to create new pipelines.
- We could create a package and either upload it to PyPI or <a href="https://gemfury.com/">Gemfury</a> (a private repository of packages for different programming languages).
- We could keep in neatly organized in GitHub and clone the repository to every new project.</p>
<p>For this use case, it would be great to work with a library that we could continuously update rather than notebooks and files getting copied around. This will help us stay organized and manage dependencies more effectively.</p>
<p>Let's get started. :)</p>
<h4 id="61-setting-up-a-dev-environment">6.1 Setting Up a Dev Environment<a class="headerlink" href="#61-setting-up-a-dev-environment" title="Permanent link">&para;</a></h4>
<p>Building frameworks can be super straightforward or a slightly cumbersome project. Because of this and because we are already using an environment to run this workshop in, I will leave here what I think is an excellent resource for learning about how to create Python Packages.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">HTML</span>
<span class="n">HTML</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">&lt;div align=&quot;center&quot;&gt;</span>
<span class="s2">    &lt;iframe width=&quot;700&quot; height=&quot;450&quot;</span>
<span class="s2">    src=&quot;https://youtube.com/embed/l7zS8Ld4_iA&quot;</span>
<span class="s2">    &lt;/iframe&gt;</span>
<span class="s2">&lt;/div&gt;</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<div align="center">
    <iframe width="700" height="450"
    src="https://youtube.com/embed/l7zS8Ld4_iA"
    </iframe>
</div>

<h4 id="62-extract">6.2 Extract<a class="headerlink" href="#62-extract" title="Permanent link">&para;</a></h4>
<p>Extracting data might seem straightforward, but it can come with plenty of caveats. For example, to access sensitive data you might need not only credentials but also access to VPNs (virtual private networks), you might have similar data in different kinds of formats (customer tables stored in legacy databases and new ones), or you might have different data all stored in one place (images, tables, and text all in a datalake) -- if you're lucky.</p>
<p>To tackle these challenges, (1) access and (2) distribution of data, companies such as <a href="https://airbyte.com/">Airbyte</a>, <a href="https://www.fivetran.com/">Fivetran</a>, and others, have come up with solutions that do all the heavy lifting for us. They have created tools that either give you connectors to common data sources (such as S3, BigQuery, and others), or give you an API so that you can develop a custom connector.</p>
<p>That said, what we'll do in this section is to create functions that allow us to extract data in different formats or download a dataset from the web. We will create one for each of the examples that we have for the workshop today. Let's get started loading some data.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">import</span> <span class="nn">urllib.request</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_and_load_file</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">path_out</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path_out</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span> <span class="n">path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">file_name</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">get_and_load_file</span><span class="p">(</span>
    <span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://archive.ics.uci.edu/ml/machine-learning-databases/00560/SeoulBikeData.csv&quot;</span><span class="p">,</span>
    <span class="n">path_out</span><span class="o">=</span><span class="s2">&quot;../data/example&quot;</span><span class="p">,</span>
    <span class="n">file_name</span><span class="o">=</span><span class="s2">&quot;seoul_exp.csv&quot;</span>
<span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>The function above will download the file into the <code>"data/example"</code> directory. If we do not specify a path for the file to <code>urllib.request.urlretrieve</code>, it would download the file into a temporary directory since it wouldn't know what to do with it or where to put it.</p>
<p>A popular alternative to <code>urllib</code> is <code>wget</code>, so you can switch the tools in this function easily. The former is part of the Python Standard Library (so you'll never have to install it), and the latter can be installed with <code>pip</code> or <code>conda</code>.</p>
<p>Let's create two more, one for csv files and the other for parquet files.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_from_csv</span><span class="p">(</span><span class="n">path_in</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_in</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">seoul_df</span> <span class="o">=</span> <span class="n">extract_from_csv</span><span class="p">(</span>
    <span class="n">path_in</span><span class="o">=</span><span class="n">data_path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;seoul&quot;</span><span class="p">,</span> <span class="s2">&quot;raw&quot;</span><span class="p">,</span> <span class="s2">&quot;SeoulBikeData.csv&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">seoul_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>Rented Bike Count</th>
      <th>Hour</th>
      <th>Temperature(ÔøΩC)</th>
      <th>Humidity(%)</th>
      <th>Wind speed (m/s)</th>
      <th>Visibility (10m)</th>
      <th>Dew point temperature(ÔøΩC)</th>
      <th>Solar Radiation (MJ/m2)</th>
      <th>Rainfall(mm)</th>
      <th>Snowfall (cm)</th>
      <th>Seasons</th>
      <th>Holiday</th>
      <th>Functioning Day</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>01/12/2017</td>
      <td>254</td>
      <td>0</td>
      <td>-5.2</td>
      <td>37</td>
      <td>2.2</td>
      <td>2000</td>
      <td>-17.6</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>Winter</td>
      <td>No Holiday</td>
      <td>Yes</td>
    </tr>
    <tr>
      <th>1</th>
      <td>01/12/2017</td>
      <td>204</td>
      <td>1</td>
      <td>-5.5</td>
      <td>38</td>
      <td>0.8</td>
      <td>2000</td>
      <td>-17.6</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>Winter</td>
      <td>No Holiday</td>
      <td>Yes</td>
    </tr>
    <tr>
      <th>2</th>
      <td>01/12/2017</td>
      <td>173</td>
      <td>2</td>
      <td>-6.0</td>
      <td>39</td>
      <td>1.0</td>
      <td>2000</td>
      <td>-17.7</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>Winter</td>
      <td>No Holiday</td>
      <td>Yes</td>
    </tr>
    <tr>
      <th>3</th>
      <td>01/12/2017</td>
      <td>107</td>
      <td>3</td>
      <td>-6.2</td>
      <td>40</td>
      <td>0.9</td>
      <td>2000</td>
      <td>-17.6</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>Winter</td>
      <td>No Holiday</td>
      <td>Yes</td>
    </tr>
    <tr>
      <th>4</th>
      <td>01/12/2017</td>
      <td>78</td>
      <td>4</td>
      <td>-6.0</td>
      <td>36</td>
      <td>2.3</td>
      <td>2000</td>
      <td>-18.6</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>Winter</td>
      <td>No Holiday</td>
      <td>Yes</td>
    </tr>
  </tbody>
</table>
</div>

<p>The reason, we've added <code>enconing</code> to our function is that files are not always shared in <code>utf-8</code> abd it is important to account for this discrepancy when creating an ETL framework. In fact, one of our datasets has a tricky format itself.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="p">}</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_from_parquet</span><span class="p">(</span><span class="n">path_in</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">path_in</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">porto_df</span> <span class="o">=</span> <span class="n">extract_from_parquet</span><span class="p">(</span>
    <span class="n">path_in</span><span class="o">=</span><span class="n">data_path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;porto&quot;</span><span class="p">,</span> <span class="s2">&quot;bike_sharing_hourly.parquet&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">porto_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>instant</th>
      <th>dteday</th>
      <th>season</th>
      <th>yr</th>
      <th>mnth</th>
      <th>hr</th>
      <th>holiday</th>
      <th>weekday</th>
      <th>workingday</th>
      <th>weathersit</th>
      <th>temp</th>
      <th>atemp</th>
      <th>hum</th>
      <th>windspeed</th>
      <th>casual</th>
      <th>registered</th>
      <th>cnt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>2011-01-01</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>6</td>
      <td>0</td>
      <td>1</td>
      <td>0.24</td>
      <td>0.2879</td>
      <td>0.81</td>
      <td>0.0</td>
      <td>3</td>
      <td>13</td>
      <td>16</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>2011-01-01</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>6</td>
      <td>0</td>
      <td>1</td>
      <td>0.22</td>
      <td>0.2727</td>
      <td>0.80</td>
      <td>0.0</td>
      <td>8</td>
      <td>32</td>
      <td>40</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>2011-01-01</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
      <td>6</td>
      <td>0</td>
      <td>1</td>
      <td>0.22</td>
      <td>0.2727</td>
      <td>0.80</td>
      <td>0.0</td>
      <td>5</td>
      <td>27</td>
      <td>32</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>2011-01-01</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>3</td>
      <td>0</td>
      <td>6</td>
      <td>0</td>
      <td>1</td>
      <td>0.24</td>
      <td>0.2879</td>
      <td>0.75</td>
      <td>0.0</td>
      <td>3</td>
      <td>10</td>
      <td>13</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>2011-01-01</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>4</td>
      <td>0</td>
      <td>6</td>
      <td>0</td>
      <td>1</td>
      <td>0.24</td>
      <td>0.2879</td>
      <td>0.75</td>
      <td>0.0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>

<p>One of our files is stored in a SQLite database so we'll use the <code>sqlite3</code> module, which is part of of the <a href="https://docs.python.org/3/library/index.html">Python Standard Library</a>, to read it.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">import</span> <span class="nn">sqlite3</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_from_db</span><span class="p">(</span><span class="n">path_in</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">path_in</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">london_df</span> <span class="o">=</span> <span class="n">extract_from_db</span><span class="p">(</span>
    <span class="n">path_in</span><span class="o">=</span><span class="n">data_path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;london&quot;</span><span class="p">,</span> <span class="s2">&quot;london_bikes.db&quot;</span><span class="p">),</span>
    <span class="n">query</span><span class="o">=</span><span class="s2">&quot;SELECT * FROM uk_bikes&quot;</span>
<span class="p">)</span>
<span class="n">london_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>timestamp</th>
      <th>cnt</th>
      <th>t1</th>
      <th>t2</th>
      <th>hum</th>
      <th>wind_speed</th>
      <th>weather_code</th>
      <th>is_holiday</th>
      <th>is_weekend</th>
      <th>seasonreal</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2015-01-04 00:00:00</td>
      <td>182</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>93.0</td>
      <td>6.0</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2015-01-04 01:00:00</td>
      <td>138</td>
      <td>3.0</td>
      <td>2.5</td>
      <td>93.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2015-01-04 02:00:00</td>
      <td>134</td>
      <td>2.5</td>
      <td>2.5</td>
      <td>96.5</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2015-01-04 03:00:00</td>
      <td>72</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>100.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2015-01-04 04:00:00</td>
      <td>47</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>93.0</td>
      <td>6.5</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
</div>

<p>Lastly, JSON files can be tricky to handle so we'll try two quick cases here using a try-except approach, but take note that as your projects evolve, it is highly likely that this function might change. A very good tool to handle large amounts of unstructured JSON that can later be formatted as a dataframe (or many), is <a href="https://examples.dask.org/bag.html">Dask Bags</a>.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_from_json</span><span class="p">(</span><span class="n">path_in</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span>  <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">path_in</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_in</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">dc_df</span> <span class="o">=</span> <span class="n">extract_from_json</span><span class="p">(</span>
    <span class="n">path_in</span><span class="o">=</span><span class="n">data_path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;wash_dc&quot;</span><span class="p">,</span> <span class="s2">&quot;washington.json&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">dc_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>/tmp/ipykernel_89543/2415585750.py:3: FutureWarning: Starting with pandas version 2.0 all arguments of read_json except for the argument &#39;path_or_buf&#39; will be keyword-only.
  data =  pd.read_json(path_in, kwargs)
</code></pre></div></td></tr></table></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>instant</th>
      <th>dteday</th>
      <th>season</th>
      <th>yr</th>
      <th>mnth</th>
      <th>hr</th>
      <th>holiday</th>
      <th>weekday</th>
      <th>workingday</th>
      <th>weathersit</th>
      <th>temp</th>
      <th>atemp</th>
      <th>hum</th>
      <th>windspeed</th>
      <th>casual</th>
      <th>registered</th>
      <th>cnt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>2011-01-01</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>6</td>
      <td>0</td>
      <td>1</td>
      <td>0.24</td>
      <td>0.2879</td>
      <td>0.81</td>
      <td>0.0</td>
      <td>3</td>
      <td>13</td>
      <td>16</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>2011-01-01</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>6</td>
      <td>0</td>
      <td>1</td>
      <td>0.22</td>
      <td>0.2727</td>
      <td>0.80</td>
      <td>0.0</td>
      <td>8</td>
      <td>32</td>
      <td>40</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>2011-01-01</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
      <td>6</td>
      <td>0</td>
      <td>1</td>
      <td>0.22</td>
      <td>0.2727</td>
      <td>0.80</td>
      <td>0.0</td>
      <td>5</td>
      <td>27</td>
      <td>32</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>2011-01-01</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>3</td>
      <td>0</td>
      <td>6</td>
      <td>0</td>
      <td>1</td>
      <td>0.24</td>
      <td>0.2879</td>
      <td>0.75</td>
      <td>0.0</td>
      <td>3</td>
      <td>10</td>
      <td>13</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>2011-01-01</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>4</td>
      <td>0</td>
      <td>6</td>
      <td>0</td>
      <td>1</td>
      <td>0.24</td>
      <td>0.2879</td>
      <td>0.75</td>
      <td>0.0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>

<p>Now that we have our functions, we want to create a file and attach to it the minimum functionality possible to use it as a command line tool. We will do this with the popular package called <code>typer</code>. It offers a delightful user experience, it respects (and annoys you at times) by type-checking your code, and it provides you with beautifully-formatted output based on the <a href="https://rich.readthedocs.io/en/latest/">rich</a> python library.</p>
<p>With <code>typer</code> we can create CLIs in several ways, and, for our purposes, we will pick the most straightforward one which works by adding <code>typer.run()</code> around a main function that encapsulates your application logic, in our case, our extract function and the upcoming ones.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">%%</span><span class="n">writefile</span> <span class="o">../</span><span class="n">src</span><span class="o">/</span><span class="n">data_eng</span><span class="o">/</span><span class="n">extract</span><span class="o">.</span><span class="n">py</span>

<span class="kn">import</span> <span class="nn">urllib.request</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">typer</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>
<span class="kn">from</span> <span class="nn">load</span> <span class="kn">import</span> <span class="n">save_data</span>


<span class="k">def</span> <span class="nf">get_and_load_file</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">path_out</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path_out</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">file_name</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">extract_from_csv</span><span class="p">(</span><span class="n">path_in</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_in</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">extract_from_db</span><span class="p">(</span><span class="n">path_in</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">path_in</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">extract_from_parquet</span><span class="p">(</span><span class="n">path_in</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">path_in</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">extract_from_json</span><span class="p">(</span><span class="n">path_in</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span>  <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">path_in</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_in</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span>
    <span class="n">arg</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="o">...</span><span class="p">),</span>
    <span class="n">url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
    <span class="n">path_in</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
    <span class="n">path_out</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
    <span class="n">encoding</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
    <span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
    <span class="n">query</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
<span class="p">):</span>
    <span class="k">if</span> <span class="n">arg</span> <span class="o">==</span> <span class="s2">&quot;get&quot;</span><span class="p">:</span>
        <span class="n">get_and_load_file</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">path_out</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">arg</span> <span class="o">==</span> <span class="s2">&quot;csv&quot;</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">extract_from_csv</span><span class="p">(</span><span class="n">path_in</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
        <span class="n">save_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">path_out</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">arg</span> <span class="o">==</span> <span class="s2">&quot;pq&quot;</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">extract_from_parquet</span><span class="p">(</span><span class="n">path_in</span><span class="p">)</span>
        <span class="n">save_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">path_out</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">arg</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">extract_from_json</span><span class="p">(</span><span class="n">path_in</span><span class="p">)</span>
        <span class="n">save_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">path_out</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">arg</span> <span class="o">==</span> <span class="s2">&quot;db&quot;</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">extract_from_db</span><span class="p">(</span><span class="n">path_in</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
        <span class="n">save_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">path_out</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not understand argument </span><span class="si">{</span><span class="n">arg</span><span class="si">}</span><span class="s2">. Please use &#39;pq&#39; for parquet files, &#39;db&#39; for database, json, or csv in lowercase.&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data Extracted Successfully!&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">typer</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>Overwriting ../src/data_eng/extract.py
</code></pre></div></td></tr></table></div>
<p>Note that we added different parameters to our <code>main</code> function to control the behavior of our CLI app.
- <code>arg</code> - the kind of data we're extracting.
- <code>url</code> - the url for when we need to download files from somewhere
- <code>path_in</code> - where is the data at
- <code>path_out</code> - where is that data going to
- <code>encoding</code> - what kind of enconding are we reading the file with
- <code>file_name</code> - what is going to be the new name of the output file
- <code>query</code> - query for the data we want from the SQL database</p>
<p>A few important things to note:
- parameters containing underscores <code>_</code> will be switched into a dash <code>-</code> by <code>typer</code>, so <code>file_name</code> will be <code>file-name</code>
- commands are run with two dashes and with a space in between it and the argument being passes, e.g. <code>--name PyCon</code>
- <code>typer.Option(None)</code> indicates to <code>typer</code> that this command can be optional, hence, when we change the kind of file we're extracting we can by pass having to put an option on others.
- by adding <code>Optional</code> around the type of a function parameter, you are also letting typer that that parameter is optional and that its default argument is <code>None</code>.
- a parameter with only a type is a required parameter.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;../data/seoul/raw/testing_cli_extract2.csv&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>Rented Bike Count</th>
      <th>Hour</th>
      <th>Temperature(ÔøΩC)</th>
      <th>Humidity(%)</th>
      <th>Wind speed (m/s)</th>
      <th>Visibility (10m)</th>
      <th>Dew point temperature(ÔøΩC)</th>
      <th>Solar Radiation (MJ/m2)</th>
      <th>Rainfall(mm)</th>
      <th>Snowfall (cm)</th>
      <th>Seasons</th>
      <th>Holiday</th>
      <th>Functioning Day</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>01/12/2017</td>
      <td>254</td>
      <td>0</td>
      <td>-5.2</td>
      <td>37</td>
      <td>2.2</td>
      <td>2000</td>
      <td>-17.6</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>Winter</td>
      <td>No Holiday</td>
      <td>Yes</td>
    </tr>
    <tr>
      <th>1</th>
      <td>01/12/2017</td>
      <td>204</td>
      <td>1</td>
      <td>-5.5</td>
      <td>38</td>
      <td>0.8</td>
      <td>2000</td>
      <td>-17.6</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>Winter</td>
      <td>No Holiday</td>
      <td>Yes</td>
    </tr>
    <tr>
      <th>2</th>
      <td>01/12/2017</td>
      <td>173</td>
      <td>2</td>
      <td>-6.0</td>
      <td>39</td>
      <td>1.0</td>
      <td>2000</td>
      <td>-17.7</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>Winter</td>
      <td>No Holiday</td>
      <td>Yes</td>
    </tr>
    <tr>
      <th>3</th>
      <td>01/12/2017</td>
      <td>107</td>
      <td>3</td>
      <td>-6.2</td>
      <td>40</td>
      <td>0.9</td>
      <td>2000</td>
      <td>-17.6</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>Winter</td>
      <td>No Holiday</td>
      <td>Yes</td>
    </tr>
    <tr>
      <th>4</th>
      <td>01/12/2017</td>
      <td>78</td>
      <td>4</td>
      <td>-6.0</td>
      <td>36</td>
      <td>2.3</td>
      <td>2000</td>
      <td>-18.6</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>Winter</td>
      <td>No Holiday</td>
      <td>Yes</td>
    </tr>
  </tbody>
</table>
</div>

<h4 id="63-transform">6.3 Transform<a class="headerlink" href="#63-transform" title="Permanent link">&para;</a></h4>
<iframe src="https://giphy.com/embed/R9zXHWAHyTjnq" width=400 height=300 ></iframe>

<p>Depending on tasks that await the final output files or tables of an ETL pipeline (e.g. reporting metrics, building machine learning models, forecasting, etc.), this step can be very convoluted or slightly straightforward. In general, though, this step can include lots of cleaning and normalization functions, and a schema setter, among many others.</p>
<p>The cleaning steps might include dealing with missing values, cleaning emails, names, addresses, and others, or putting values of similar nature into the same format (e.g. different weather measurements into one).</p>
<p>Normalization can be anything from changing column names with the same values but different names to have the same one, or height in cm vs feet and inches to be in the same measure, or ..., you get the point. :)</p>
<p>A schema is the way in which we represent not only the content and type of our new data files/tables, but also the way in which we represent their relationship. A common schema is the <a href="https://www.databricks.com/glossary/star-schema">star schema</a>. An uncommon (but rising star) schema is the <a href="https://www.activityschema.com/">activity schema</a>.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">import</span> <span class="nn">re</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">#create some toy data for our Bicycle problem</span>

<span class="n">toy_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Postal Codes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">22345</span><span class="p">,</span> <span class="mi">32442</span><span class="p">,</span> <span class="mi">20007</span><span class="p">],</span> 
                         <span class="s2">&quot;Cities&#39;&quot;</span><span class="p">:</span>       <span class="p">[</span><span class="s2">&quot;Miami,  FL&quot;</span><span class="p">,</span> <span class="s2">&quot;Dallas, TX&quot;</span><span class="p">,</span> <span class="s2">&quot;Washington, DC&quot;</span><span class="p">],</span>
                         <span class="s2">&quot;Dates as mm-dd-yyy&quot;</span><span class="p">:</span>         <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;9/27/2021&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">)})</span>
<span class="n">toy_data</span>
</code></pre></div></td></tr></table></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Postal Codes</th>
      <th>Cities'</th>
      <th>Dates as mm-dd-yyy</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>22345</td>
      <td>Miami,  FL</td>
      <td>2021-09-27</td>
    </tr>
    <tr>
      <th>1</th>
      <td>32442</td>
      <td>Dallas, TX</td>
      <td>2021-09-28</td>
    </tr>
    <tr>
      <th>2</th>
      <td>20007</td>
      <td>Washington, DC</td>
      <td>2021-09-29</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">clean_col_names</span><span class="p">(</span><span class="n">index_of_cols</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^a-zA-Z0-9\s_]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">index_of_cols</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">clean_col_names</span><span class="p">(</span><span class="n">toy_data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>[&#39;postal_codes&#39;, &#39;cities&#39;, &#39;dates_as_mmddyyy&#39;]
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_dates</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">date_col</span><span class="p">,</span> <span class="n">hour_col</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">date_col</span><span class="p">],</span> <span class="n">infer_datetime_format</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;hour&quot;</span><span class="p">,</span> <span class="s2">&quot;Hour&quot;</span><span class="p">,</span> <span class="s2">&quot;hr&quot;</span><span class="p">,</span> <span class="s2">&quot;HR&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
        <span class="c1">#Time series datasets need to be ordered by time.</span>
        <span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;hour&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">hour_col</span><span class="p">:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="n">hour_col</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You must figure out how the hour works in your file.&quot;</span><span class="p">)</span>

    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span>           <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">]</span>          <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;week&quot;</span><span class="p">]</span>           <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">isocalendar</span><span class="p">()</span><span class="o">.</span><span class="n">week</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;day&quot;</span><span class="p">]</span>            <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;day_of_week&quot;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofweek</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;is_month_start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">is_month_start</span>    

    <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">extract_dates</span><span class="p">(</span><span class="n">london_df</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>timestamp</th>
      <th>cnt</th>
      <th>t1</th>
      <th>t2</th>
      <th>hum</th>
      <th>wind_speed</th>
      <th>weather_code</th>
      <th>is_holiday</th>
      <th>is_weekend</th>
      <th>seasonreal</th>
      <th>hour</th>
      <th>year</th>
      <th>month</th>
      <th>week</th>
      <th>day</th>
      <th>day_of_week</th>
      <th>is_month_start</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2015-01-04 00:00:00</td>
      <td>182</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>93.0</td>
      <td>6.0</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>0</td>
      <td>2015</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>6</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2015-01-04 01:00:00</td>
      <td>138</td>
      <td>3.0</td>
      <td>2.5</td>
      <td>93.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>1</td>
      <td>2015</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>6</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2015-01-04 02:00:00</td>
      <td>134</td>
      <td>2.5</td>
      <td>2.5</td>
      <td>96.5</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>2</td>
      <td>2015</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>6</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2015-01-04 03:00:00</td>
      <td>72</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>100.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>3</td>
      <td>2015</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>6</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2015-01-04 04:00:00</td>
      <td>47</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>93.0</td>
      <td>6.5</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>4</td>
      <td>2015</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>6</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div>

<p>A common tasks in data science is to create dummy variables, which is ofter referred to as one-hot encoding. These are binary representations of a category, for example, if you have a columns with different kinds of cars, after you one-hot encode it, you will have one column for sedan, coupe, convertible, and so on, and each will be represented with a 0 or a 1 for when it is available and when it isn't, respectively.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">one_hot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">cols_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">cols_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">one_hot</span><span class="p">(</span><span class="n">seoul_df</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Seasons&quot;</span><span class="p">,</span> <span class="s2">&quot;Holiday&quot;</span><span class="p">],</span> <span class="n">drop_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>Rented Bike Count</th>
      <th>Hour</th>
      <th>Temperature(ÔøΩC)</th>
      <th>Humidity(%)</th>
      <th>Wind speed (m/s)</th>
      <th>Visibility (10m)</th>
      <th>Dew point temperature(ÔøΩC)</th>
      <th>Solar Radiation (MJ/m2)</th>
      <th>Rainfall(mm)</th>
      <th>Snowfall (cm)</th>
      <th>Functioning Day</th>
      <th>Seasons_Spring</th>
      <th>Seasons_Summer</th>
      <th>Seasons_Winter</th>
      <th>Holiday_No Holiday</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>01/12/2017</td>
      <td>254</td>
      <td>0</td>
      <td>-5.2</td>
      <td>37</td>
      <td>2.2</td>
      <td>2000</td>
      <td>-17.6</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>Yes</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>01/12/2017</td>
      <td>204</td>
      <td>1</td>
      <td>-5.5</td>
      <td>38</td>
      <td>0.8</td>
      <td>2000</td>
      <td>-17.6</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>Yes</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>01/12/2017</td>
      <td>173</td>
      <td>2</td>
      <td>-6.0</td>
      <td>39</td>
      <td>1.0</td>
      <td>2000</td>
      <td>-17.7</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>Yes</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>01/12/2017</td>
      <td>107</td>
      <td>3</td>
      <td>-6.2</td>
      <td>40</td>
      <td>0.9</td>
      <td>2000</td>
      <td>-17.6</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>Yes</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>01/12/2017</td>
      <td>78</td>
      <td>4</td>
      <td>-6.0</td>
      <td>36</td>
      <td>2.3</td>
      <td>2000</td>
      <td>-18.6</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>Yes</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_location_cols</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">place</span><span class="p">):</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;loc_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">place</span>
    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">add_location_cols</span><span class="p">(</span><span class="n">dc_df</span><span class="p">,</span> <span class="s2">&quot;DC&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>instant</th>
      <th>dteday</th>
      <th>season</th>
      <th>yr</th>
      <th>mnth</th>
      <th>hr</th>
      <th>holiday</th>
      <th>weekday</th>
      <th>workingday</th>
      <th>weathersit</th>
      <th>temp</th>
      <th>atemp</th>
      <th>hum</th>
      <th>windspeed</th>
      <th>casual</th>
      <th>registered</th>
      <th>cnt</th>
      <th>loc_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>2011-01-01</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>6</td>
      <td>0</td>
      <td>1</td>
      <td>0.24</td>
      <td>0.2879</td>
      <td>0.81</td>
      <td>0.0</td>
      <td>3</td>
      <td>13</td>
      <td>16</td>
      <td>DC</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>2011-01-01</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>6</td>
      <td>0</td>
      <td>1</td>
      <td>0.22</td>
      <td>0.2727</td>
      <td>0.80</td>
      <td>0.0</td>
      <td>8</td>
      <td>32</td>
      <td>40</td>
      <td>DC</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>2011-01-01</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
      <td>6</td>
      <td>0</td>
      <td>1</td>
      <td>0.22</td>
      <td>0.2727</td>
      <td>0.80</td>
      <td>0.0</td>
      <td>5</td>
      <td>27</td>
      <td>32</td>
      <td>DC</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>2011-01-01</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>3</td>
      <td>0</td>
      <td>6</td>
      <td>0</td>
      <td>1</td>
      <td>0.24</td>
      <td>0.2879</td>
      <td>0.75</td>
      <td>0.0</td>
      <td>3</td>
      <td>10</td>
      <td>13</td>
      <td>DC</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>2011-01-01</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>4</td>
      <td>0</td>
      <td>6</td>
      <td>0</td>
      <td>1</td>
      <td>0.24</td>
      <td>0.2879</td>
      <td>0.75</td>
      <td>0.0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>DC</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fix_and_drop</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">col_to_fix</span><span class="p">,</span> <span class="n">mapping</span><span class="p">,</span> <span class="n">cols_to_drop</span><span class="p">):</span>
    <span class="n">data</span><span class="p">[</span><span class="n">col_to_fix</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">col_to_fix</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">cols_to_drop</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">seasons_london</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Spring&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Summer&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Fall&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Winter&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
<span class="n">cols_drop_london</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;t2&#39;</span><span class="p">,</span> <span class="s1">&#39;weather_code&#39;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">london_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>timestamp</th>
      <th>cnt</th>
      <th>t1</th>
      <th>t2</th>
      <th>hum</th>
      <th>wind_speed</th>
      <th>weather_code</th>
      <th>is_holiday</th>
      <th>is_weekend</th>
      <th>seasonreal</th>
      <th>hour</th>
      <th>year</th>
      <th>month</th>
      <th>week</th>
      <th>day</th>
      <th>day_of_week</th>
      <th>is_month_start</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2015-01-04 00:00:00</td>
      <td>182</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>93.0</td>
      <td>6.0</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>0</td>
      <td>2015</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>6</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2015-01-04 01:00:00</td>
      <td>138</td>
      <td>3.0</td>
      <td>2.5</td>
      <td>93.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>1</td>
      <td>2015</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>6</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2015-01-04 02:00:00</td>
      <td>134</td>
      <td>2.5</td>
      <td>2.5</td>
      <td>96.5</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>2</td>
      <td>2015</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>6</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2015-01-04 03:00:00</td>
      <td>72</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>100.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>3</td>
      <td>2015</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>6</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2015-01-04 04:00:00</td>
      <td>47</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>93.0</td>
      <td>6.5</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>4</td>
      <td>2015</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>6</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">london_df</span><span class="p">[</span><span class="s2">&quot;seasonreal&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">seasons_london</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code>0    4394
1    4387
3    4330
2    4303
Name: seasonreal, dtype: int64
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">fix_and_drop</span><span class="p">(</span><span class="n">london_df</span><span class="p">,</span> <span class="s2">&quot;seasonreal&quot;</span><span class="p">,</span> <span class="n">seasons_london</span><span class="p">,</span> <span class="n">cols_drop_london</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>timestamp</th>
      <th>cnt</th>
      <th>t1</th>
      <th>hum</th>
      <th>wind_speed</th>
      <th>is_holiday</th>
      <th>is_weekend</th>
      <th>seasonreal</th>
      <th>hour</th>
      <th>year</th>
      <th>month</th>
      <th>week</th>
      <th>day</th>
      <th>day_of_week</th>
      <th>is_month_start</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2015-01-04 00:00:00</td>
      <td>182</td>
      <td>3.0</td>
      <td>93.0</td>
      <td>6.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>Winter</td>
      <td>0</td>
      <td>2015</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>6</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2015-01-04 01:00:00</td>
      <td>138</td>
      <td>3.0</td>
      <td>93.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>Winter</td>
      <td>1</td>
      <td>2015</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>6</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2015-01-04 02:00:00</td>
      <td>134</td>
      <td>2.5</td>
      <td>96.5</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>Winter</td>
      <td>2</td>
      <td>2015</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>6</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2015-01-04 03:00:00</td>
      <td>72</td>
      <td>2.0</td>
      <td>100.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>Winter</td>
      <td>3</td>
      <td>2015</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>6</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2015-01-04 04:00:00</td>
      <td>47</td>
      <td>2.0</td>
      <td>93.0</td>
      <td>6.5</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>Winter</td>
      <td>4</td>
      <td>2015</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>6</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">order_and_merge</span><span class="p">(</span><span class="n">data_lists</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">pick_order</span> <span class="o">=</span> <span class="n">data_lists</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span> <span class="c1">#takes order of columns of the first dataset</span>
    <span class="c1">#reindexing columns by the order of the first dataset, then sorting by date and hour.</span>
    <span class="k">if</span> <span class="n">date</span><span class="p">:</span>
        <span class="n">new_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">pick_order</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="n">date</span><span class="p">,</span> <span class="s1">&#39;hour&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data_lists</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_list</span> <span class="o">=</span> <span class="n">data_lists</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">new_list</span><span class="p">)</span> <span class="c1">#merge all</span>
</code></pre></div></td></tr></table></div>
<h4 id="exercise">Exercise<a class="headerlink" href="#exercise" title="Permanent link">&para;</a></h4>
<p>Pick any two datasets and
- select 5 columns from each
- change column names as appropriate
- use the order_and_nerge function to combine both</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">london_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>timestamp</th>
      <th>cnt</th>
      <th>t1</th>
      <th>t2</th>
      <th>hum</th>
      <th>wind_speed</th>
      <th>weather_code</th>
      <th>is_holiday</th>
      <th>is_weekend</th>
      <th>seasonreal</th>
      <th>hour</th>
      <th>year</th>
      <th>month</th>
      <th>week</th>
      <th>day</th>
      <th>day_of_week</th>
      <th>is_month_start</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2015-01-04 00:00:00</td>
      <td>182</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>93.0</td>
      <td>6.0</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>Winter</td>
      <td>0</td>
      <td>2015</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>6</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2015-01-04 01:00:00</td>
      <td>138</td>
      <td>3.0</td>
      <td>2.5</td>
      <td>93.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>Winter</td>
      <td>1</td>
      <td>2015</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>6</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2015-01-04 02:00:00</td>
      <td>134</td>
      <td>2.5</td>
      <td>2.5</td>
      <td>96.5</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>Winter</td>
      <td>2</td>
      <td>2015</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>6</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2015-01-04 03:00:00</td>
      <td>72</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>100.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>Winter</td>
      <td>3</td>
      <td>2015</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>6</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2015-01-04 04:00:00</td>
      <td>47</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>93.0</td>
      <td>6.5</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>Winter</td>
      <td>4</td>
      <td>2015</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>6</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">london_df_small</span> <span class="o">=</span> <span class="n">london_df</span><span class="p">[[</span><span class="s2">&quot;cnt&quot;</span><span class="p">,</span> <span class="s2">&quot;t1&quot;</span><span class="p">,</span> <span class="s2">&quot;wind_speed&quot;</span><span class="p">,</span> <span class="s2">&quot;seasonreal&quot;</span><span class="p">,</span> <span class="s2">&quot;hour&quot;</span><span class="p">]]</span>
<span class="n">london_df_small</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cnt</th>
      <th>t1</th>
      <th>wind_speed</th>
      <th>seasonreal</th>
      <th>hour</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>17409</th>
      <td>1042</td>
      <td>5.0</td>
      <td>19.0</td>
      <td>Winter</td>
      <td>19</td>
    </tr>
    <tr>
      <th>17410</th>
      <td>541</td>
      <td>5.0</td>
      <td>21.0</td>
      <td>Winter</td>
      <td>20</td>
    </tr>
    <tr>
      <th>17411</th>
      <td>337</td>
      <td>5.5</td>
      <td>24.0</td>
      <td>Winter</td>
      <td>21</td>
    </tr>
    <tr>
      <th>17412</th>
      <td>224</td>
      <td>5.5</td>
      <td>23.0</td>
      <td>Winter</td>
      <td>22</td>
    </tr>
    <tr>
      <th>17413</th>
      <td>139</td>
      <td>5.0</td>
      <td>22.0</td>
      <td>Winter</td>
      <td>23</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">seoul_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>Rented Bike Count</th>
      <th>Hour</th>
      <th>Temperature(ÔøΩC)</th>
      <th>Humidity(%)</th>
      <th>Wind speed (m/s)</th>
      <th>Visibility (10m)</th>
      <th>Dew point temperature(ÔøΩC)</th>
      <th>Solar Radiation (MJ/m2)</th>
      <th>Rainfall(mm)</th>
      <th>Snowfall (cm)</th>
      <th>Seasons</th>
      <th>Holiday</th>
      <th>Functioning Day</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>01/12/2017</td>
      <td>254</td>
      <td>0</td>
      <td>-5.2</td>
      <td>37</td>
      <td>2.2</td>
      <td>2000</td>
      <td>-17.6</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>Winter</td>
      <td>No Holiday</td>
      <td>Yes</td>
    </tr>
    <tr>
      <th>1</th>
      <td>01/12/2017</td>
      <td>204</td>
      <td>1</td>
      <td>-5.5</td>
      <td>38</td>
      <td>0.8</td>
      <td>2000</td>
      <td>-17.6</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>Winter</td>
      <td>No Holiday</td>
      <td>Yes</td>
    </tr>
    <tr>
      <th>2</th>
      <td>01/12/2017</td>
      <td>173</td>
      <td>2</td>
      <td>-6.0</td>
      <td>39</td>
      <td>1.0</td>
      <td>2000</td>
      <td>-17.7</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>Winter</td>
      <td>No Holiday</td>
      <td>Yes</td>
    </tr>
    <tr>
      <th>3</th>
      <td>01/12/2017</td>
      <td>107</td>
      <td>3</td>
      <td>-6.2</td>
      <td>40</td>
      <td>0.9</td>
      <td>2000</td>
      <td>-17.6</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>Winter</td>
      <td>No Holiday</td>
      <td>Yes</td>
    </tr>
    <tr>
      <th>4</th>
      <td>01/12/2017</td>
      <td>78</td>
      <td>4</td>
      <td>-6.0</td>
      <td>36</td>
      <td>2.3</td>
      <td>2000</td>
      <td>-18.6</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>Winter</td>
      <td>No Holiday</td>
      <td>Yes</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">seoul_df_small</span> <span class="o">=</span> <span class="n">seoul_df</span><span class="p">[[</span><span class="s2">&quot;Rented Bike Count&quot;</span><span class="p">,</span> <span class="s2">&quot;Temperature(ÔøΩC)&quot;</span><span class="p">,</span> <span class="s2">&quot;Wind speed (m/s)&quot;</span><span class="p">,</span> <span class="s2">&quot;Seasons&quot;</span><span class="p">,</span> <span class="s2">&quot;Hour&quot;</span><span class="p">]]</span>
<span class="n">seoul_df_small</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Rented Bike Count</th>
      <th>Temperature(ÔøΩC)</th>
      <th>Wind speed (m/s)</th>
      <th>Seasons</th>
      <th>Hour</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>254</td>
      <td>-5.2</td>
      <td>2.2</td>
      <td>Winter</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>204</td>
      <td>-5.5</td>
      <td>0.8</td>
      <td>Winter</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>173</td>
      <td>-6.0</td>
      <td>1.0</td>
      <td>Winter</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>107</td>
      <td>-6.2</td>
      <td>0.9</td>
      <td>Winter</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>78</td>
      <td>-6.0</td>
      <td>2.3</td>
      <td>Winter</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">seoul_df_small</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">london_df_small</span><span class="o">.</span><span class="n">columns</span>
<span class="n">seoul_df_small</span><span class="o">.</span><span class="n">columns</span> <span class="o">==</span> <span class="n">london_df_small</span><span class="o">.</span><span class="n">columns</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>array([ True,  True,  True,  True,  True])
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">order_and_merge</span><span class="p">([</span><span class="n">seoul_df_small</span><span class="p">,</span> <span class="n">london_df_small</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>(26174, 5)
</code></pre></div></td></tr></table></div>
<p>Finally, we take the same approach as with the extract set of functions and wrap our transform workflow into a <code>main</code> function, and then that <code>main</code> function into a typer CLI.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">%%</span><span class="n">writefile</span> <span class="o">../</span><span class="n">src</span><span class="o">/</span><span class="n">data_eng</span><span class="o">/</span><span class="n">transform</span><span class="o">.</span><span class="n">py</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span><span class="o">,</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">extract</span> <span class="kn">import</span> <span class="n">save_data</span>
<span class="kn">import</span> <span class="nn">typer</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">List</span>

<span class="k">def</span> <span class="nf">clean_col_names</span><span class="p">(</span><span class="n">index_of_cols</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^a-zA-Z0-9\s_]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">index_of_cols</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">extract_dates</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">date_col</span><span class="p">,</span> <span class="n">hour_col</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">date_col</span><span class="p">],</span> <span class="n">infer_datetime_format</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;hour&quot;</span><span class="p">,</span> <span class="s2">&quot;Hour&quot;</span><span class="p">,</span> <span class="s2">&quot;hr&quot;</span><span class="p">,</span> <span class="s2">&quot;HR&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
        <span class="c1">#Time series datasets need to be ordered by time.</span>
        <span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;hour&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">hour_col</span><span class="p">:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="n">hour_col</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You must figure out how the hour works in your file.&quot;</span><span class="p">)</span>

    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span>           <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">]</span>          <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;week&quot;</span><span class="p">]</span>           <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">isocalendar</span><span class="p">()</span><span class="o">.</span><span class="n">week</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;day&quot;</span><span class="p">]</span>            <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;day_of_week&quot;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofweek</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;is_month_start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">is_month_start</span>    

    <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>

<span class="k">def</span> <span class="nf">one_hot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">cols_list</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">cols_list</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">add_location_cols</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">place</span><span class="p">):</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;loc_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">place</span>
    <span class="k">return</span> <span class="n">data</span>

<span class="k">def</span> <span class="nf">fix_and_drop</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">col_to_fix</span><span class="p">,</span> <span class="n">mapping</span><span class="p">,</span> <span class="n">cols_to_drop</span><span class="p">):</span>
    <span class="n">data</span><span class="p">[</span><span class="n">col_to_fix</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">col_to_fix</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">cols_to_drop</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">order_and_merge</span><span class="p">(</span><span class="n">data_lists</span><span class="p">):</span>
    <span class="n">pick_order</span> <span class="o">=</span> <span class="n">data_lists</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span> <span class="c1">#takes order of columns of the first dataset</span>
    <span class="n">new_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">pick_order</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;hour&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data_lists</span><span class="p">]</span> <span class="c1">#reindexing columns by the order of the first dataset, then sorting by date and hour.</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">new_list</span><span class="p">)</span> <span class="c1">#merge all</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span>
    <span class="n">path_in</span><span class="p">:</span>   <span class="nb">str</span>           <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="o">...</span><span class="p">),</span>
    <span class="n">date_col</span><span class="p">:</span>  <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
    <span class="n">hour_col</span><span class="p">:</span>  <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
    <span class="n">cols_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>     <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
    <span class="n">place</span><span class="p">:</span>     <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
    <span class="n">path_out</span><span class="p">:</span>  <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
    <span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">path_in</span><span class="p">)</span>
    <span class="c1"># data.columns = clean_col_names(data.columns)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">extract_dates</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">date_col</span><span class="p">,</span> <span class="n">hour_col</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cols_list</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">one_hot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">cols_list</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">clean_col_names</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">add_location_cols</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">place</span><span class="p">)</span>
    <span class="n">save_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">path_out</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data Extracted and Transformed Successfully!&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">typer</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>Overwriting ../src/data_eng/transform.py
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;../data/seoul/interim/cli_test_clean.parquet&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>rented_bike_count</th>
      <th>hour</th>
      <th>temperaturec</th>
      <th>humidity</th>
      <th>wind_speed_ms</th>
      <th>visibility_10m</th>
      <th>dew_point_temperaturec</th>
      <th>solar_radiation_mjm2</th>
      <th>rainfallmm</th>
      <th>...</th>
      <th>seasons</th>
      <th>holiday</th>
      <th>functioning_day</th>
      <th>year</th>
      <th>month</th>
      <th>week</th>
      <th>day</th>
      <th>day_of_week</th>
      <th>is_month_start</th>
      <th>loc_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>01/12/2017</td>
      <td>254</td>
      <td>0</td>
      <td>-5.2</td>
      <td>37</td>
      <td>2.2</td>
      <td>2000</td>
      <td>-17.6</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>Winter</td>
      <td>No Holiday</td>
      <td>Yes</td>
      <td>2017</td>
      <td>1</td>
      <td>2</td>
      <td>12</td>
      <td>3</td>
      <td>False</td>
      <td>Seoul</td>
    </tr>
    <tr>
      <th>1</th>
      <td>01/12/2017</td>
      <td>204</td>
      <td>1</td>
      <td>-5.5</td>
      <td>38</td>
      <td>0.8</td>
      <td>2000</td>
      <td>-17.6</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>Winter</td>
      <td>No Holiday</td>
      <td>Yes</td>
      <td>2017</td>
      <td>1</td>
      <td>2</td>
      <td>12</td>
      <td>3</td>
      <td>False</td>
      <td>Seoul</td>
    </tr>
    <tr>
      <th>2</th>
      <td>01/12/2017</td>
      <td>173</td>
      <td>2</td>
      <td>-6.0</td>
      <td>39</td>
      <td>1.0</td>
      <td>2000</td>
      <td>-17.7</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>Winter</td>
      <td>No Holiday</td>
      <td>Yes</td>
      <td>2017</td>
      <td>1</td>
      <td>2</td>
      <td>12</td>
      <td>3</td>
      <td>False</td>
      <td>Seoul</td>
    </tr>
    <tr>
      <th>3</th>
      <td>01/12/2017</td>
      <td>107</td>
      <td>3</td>
      <td>-6.2</td>
      <td>40</td>
      <td>0.9</td>
      <td>2000</td>
      <td>-17.6</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>Winter</td>
      <td>No Holiday</td>
      <td>Yes</td>
      <td>2017</td>
      <td>1</td>
      <td>2</td>
      <td>12</td>
      <td>3</td>
      <td>False</td>
      <td>Seoul</td>
    </tr>
    <tr>
      <th>4</th>
      <td>01/12/2017</td>
      <td>78</td>
      <td>4</td>
      <td>-6.0</td>
      <td>36</td>
      <td>2.3</td>
      <td>2000</td>
      <td>-18.6</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>Winter</td>
      <td>No Holiday</td>
      <td>Yes</td>
      <td>2017</td>
      <td>1</td>
      <td>2</td>
      <td>12</td>
      <td>3</td>
      <td>False</td>
      <td>Seoul</td>
    </tr>
  </tbody>
</table>
<p>5 rows √ó 21 columns</p>
</div>

<h4 id="62-load">6.2 Load<a class="headerlink" href="#62-load" title="Permanent link">&para;</a></h4>
<p>The loading stage, at least for analytical purposes, tends to be a data warehouse like BigQuery, Redshift, etc., but it can also be a directory in a data lake where files are saved in the highly optimized parquet format.</p>
<p>In order for us to simulate a data warehouse locally, we will create a duckdb database using the python library <code>ibis</code>. The reason we will do it this ways is that ibis can translate the schema of our files into the duckdb SQL in one line of code. Effectively saving us boilerplate code that may or may not end up accounting for every feature in our dataframes.</p>
<p>Ibis is a very cool project, especially if your SQL skills as basic as mine, so I highly encourage you to check it out. :)</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">import</span> <span class="nn">ibis</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">data_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">()</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="o">/</span><span class="s2">&quot;data/&quot;</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_db</span><span class="p">(</span><span class="n">path_in</span><span class="p">,</span> <span class="n">path_out</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">table_name</span><span class="p">):</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path_out</span><span class="p">)</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">ibis</span><span class="o">.</span><span class="n">duckdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">file_name</span><span class="p">))</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">path_in</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="n">table_name</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully loaded the </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2"> table!&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">create_db</span><span class="p">(</span>
    <span class="n">path_in</span><span class="o">=</span><span class="n">data_path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;porto&quot;</span><span class="p">,</span> <span class="s2">&quot;bike_sharing_hourly.parquet&quot;</span><span class="p">),</span>
    <span class="n">path_out</span><span class="o">=</span><span class="s2">&quot;../data/dwarehouse&quot;</span><span class="p">,</span>
    <span class="n">file_name</span><span class="o">=</span><span class="s2">&quot;mytest_dw.ddb&quot;</span><span class="p">,</span>
    <span class="n">table_name</span><span class="o">=</span><span class="s2">&quot;one_day&quot;</span>
<span class="p">)</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>Successfully loaded the one_day table!
</code></pre></div></td></tr></table></div>
<p>Let's read in our data to check that it was loaded successfully.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">import</span> <span class="nn">duckdb</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">duck</span> <span class="o">=</span> <span class="n">duckdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;../data/dwarehouse/mytest_dw.ddb&quot;</span><span class="p">)</span>
<span class="n">duck</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM one_day&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">df</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>instant</th>
      <th>dteday</th>
      <th>season</th>
      <th>yr</th>
      <th>mnth</th>
      <th>hr</th>
      <th>holiday</th>
      <th>weekday</th>
      <th>workingday</th>
      <th>weathersit</th>
      <th>temp</th>
      <th>atemp</th>
      <th>hum</th>
      <th>windspeed</th>
      <th>casual</th>
      <th>registered</th>
      <th>cnt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>2011-01-01</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>6</td>
      <td>0</td>
      <td>1</td>
      <td>0.24</td>
      <td>0.2879</td>
      <td>0.81</td>
      <td>0.0</td>
      <td>3</td>
      <td>13</td>
      <td>16</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>2011-01-01</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>6</td>
      <td>0</td>
      <td>1</td>
      <td>0.22</td>
      <td>0.2727</td>
      <td>0.80</td>
      <td>0.0</td>
      <td>8</td>
      <td>32</td>
      <td>40</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>2011-01-01</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
      <td>6</td>
      <td>0</td>
      <td>1</td>
      <td>0.22</td>
      <td>0.2727</td>
      <td>0.80</td>
      <td>0.0</td>
      <td>5</td>
      <td>27</td>
      <td>32</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>2011-01-01</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>3</td>
      <td>0</td>
      <td>6</td>
      <td>0</td>
      <td>1</td>
      <td>0.24</td>
      <td>0.2879</td>
      <td>0.75</td>
      <td>0.0</td>
      <td>3</td>
      <td>10</td>
      <td>13</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>2011-01-01</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>4</td>
      <td>0</td>
      <td>6</td>
      <td>0</td>
      <td>1</td>
      <td>0.24</td>
      <td>0.2879</td>
      <td>0.75</td>
      <td>0.0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_parquet</span><span class="p">(</span><span class="n">path_in</span><span class="p">,</span> <span class="n">path_out</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path_out</span><span class="p">)</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">path_in</span><span class="p">)</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">file_name</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully loaded the </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2"> table!&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">path_out</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
    <span class="n">path_out</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path_out</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">path_out</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span> <span class="n">path_out</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">path_out</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">file_name</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully loaded the </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2"> table!&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>We take the same steps as before and wrap our main function with <code>typer.run()</code> to make it a CLI, we test that it works well, and then go on to the next stage.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">%%</span><span class="n">writefile</span> <span class="o">../</span><span class="n">src</span><span class="o">/</span><span class="n">data_eng</span><span class="o">/</span><span class="n">load</span><span class="o">.</span><span class="n">py</span>

<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">ibis</span>
<span class="kn">import</span> <span class="nn">typer</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>


<span class="k">def</span> <span class="nf">create_db</span><span class="p">(</span><span class="n">path_in</span><span class="p">,</span> <span class="n">path_out</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">table_name</span><span class="p">):</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path_out</span><span class="p">)</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">ibis</span><span class="o">.</span><span class="n">duckdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">file_name</span><span class="p">))</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">path_in</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="n">table_name</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully loaded the </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2"> table!&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">create_parquet</span><span class="p">(</span><span class="n">path_in</span><span class="p">,</span> <span class="n">path_out</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path_out</span><span class="p">)</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">path_in</span><span class="p">)</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">file_name</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully loaded the </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2"> table!&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">save_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">path_out</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
    <span class="n">path_out</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path_out</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">path_out</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span> <span class="n">path_out</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">path_out</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">file_name</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully loaded the </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2"> table!&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span>
    <span class="n">kind</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="o">...</span><span class="p">),</span>
    <span class="n">path_in</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> 
    <span class="n">path_out</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
    <span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
    <span class="n">table_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<span class="p">):</span>
    <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s2">&quot;db&quot;</span><span class="p">:</span>
        <span class="n">create_db</span><span class="p">(</span><span class="n">path_in</span><span class="p">,</span> <span class="n">path_out</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">table_name</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s2">&quot;pq&quot;</span><span class="p">:</span>
        <span class="n">create_parquet</span><span class="p">(</span><span class="n">path_in</span><span class="p">,</span> <span class="n">path_out</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not understand argument </span><span class="si">{</span><span class="n">kind</span><span class="si">}</span><span class="s2">. Please use &#39;pq&#39; for parquet files or &#39;db&#39; for database.&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data Extracted Successfully!&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">typer</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>Overwriting ../src/data_eng/load.py
</code></pre></div></td></tr></table></div>
<h3 id="7-reproducible-pipelines">7. Reproducible Pipelines<a class="headerlink" href="#7-reproducible-pipelines" title="Permanent link">&para;</a></h3>
<p>Data Version Control or <code>dvc</code> is a tool for version almost any kind of file you can think of. From images, text, videos, and excel spreadsheets, to machine learning models and other artifacts. In addition, it is also an excellent tool for tracking machine learning experiments and for creating language agnostic pipelines where you can automatically version control the inputs and outputs of your workflows. </p>
<p>If you have ever used git then the following commands will feel like home</p>
<ul>
<li><code>dvc init</code> --&gt; this the first step to get started using dvc (after installing it of course)</li>
<li><code>dvc remote add -d storage gdrive://your_hash</code> --&gt; since we will be tracking files somewhere, this command will help set up a remote repository for these.</li>
<li><code>dvc add</code> --&gt; add a file to track.</li>
<li><code>dvc push</code> --&gt; push the file to your remote repository.</li>
<li><code>dvc pull</code> --&gt; pull the file from your remote repository and into your local machine.</li>
<li><code>dvc stage</code> --&gt; allows you to start adding steps to a pipeline. It will create a <code>dvc.yml</code> file containing the steps of the pipeline. This can be modified manually as well.</li>
<li><code>dvc repro</code> --&gt; Once we finish our stage, or as we add steps to it, we can run our pipeline with this command. The best part is that the steps will get cashed, so if nothing changes, nothing will get rerun.</li>
<li><code>dvc dag</code> --&gt; allows you to visualize your pipelines as a graph in the terminal.</li>
</ul>
<p>Finally, some of the settings for our repo will be available at <code>.dvc/config</code> and these can be changed manually at any time.</p>
<p>Open a terminal in the main directory for this workshop and follow along.</p>
<p>To create our pipeline, we'll add the stages step by step.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code>dvc<span class="w"> </span>stage<span class="w"> </span>add<span class="w"> </span>--name<span class="w"> </span>seoul_extract<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--deps<span class="w"> </span>data/seoul/SeoulBikeData.csv<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--outs<span class="w"> </span>data/seoul/raw/seoul_raw.parquet<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>python<span class="w"> </span>src/data_eng/extract.py<span class="w"> </span>--arg<span class="w"> </span>csv<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--path-in<span class="w"> </span>data/seoul/SeoulBikeData.csv<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--path-out<span class="w"> </span>data/seoul/raw<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--file-name<span class="w"> </span>seoul_raw.parquet<span class="w"> </span>--encoding<span class="w"> </span>iso-8859-1
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code>dvc<span class="w"> </span>stage<span class="w"> </span>add<span class="w"> </span>--name<span class="w"> </span>seoul_transform<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--deps<span class="w"> </span>data/seoul/raw/seoul_raw.parquet<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--outs<span class="w"> </span>data/seoul/interim/seoul_clean.parquet<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>python<span class="w"> </span>src/data_eng/transform.py<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--path-in<span class="w"> </span>data/seoul/seoul_raw.parquet<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--date-col<span class="w"> </span>Date<span class="w"> </span>--hour-col<span class="w"> </span>Hour<span class="w"> </span>--place<span class="w"> </span>Seoul<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--path-out<span class="w"> </span>data/seoul/interim<span class="w"> </span>--file-name<span class="w"> </span>seoul_clean.parquet
</code></pre></div></td></tr></table></div>
<h4 id="exercise_1">Exercise<a class="headerlink" href="#exercise_1" title="Permanent link">&para;</a></h4>
<p>Add the load stage into our pipeline following the examples above.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code>dvc<span class="w"> </span>stage<span class="w"> </span>add<span class="w"> </span>--name<span class="w"> </span>seoul_load<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--deps<span class="w"> </span>data/seoul/interim/seoul_clean.parquet<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--outs<span class="w"> </span>data/dwarehouse/analytics.db<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>python<span class="w"> </span>src/data_eng/load.py<span class="w"> </span>--kind<span class="w"> </span>db<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--path-in<span class="w"> </span>data/seoul/interim/seoul_clean.parquet<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--path-out<span class="w"> </span>data/dwarehouse<span class="w"> </span>--name<span class="w"> </span>analytics.db<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--table-name<span class="w"> </span>seoul_main
</code></pre></div></td></tr></table></div>
<p>Finally we can run our pipeline, evaluate it, and push our files into our remote storage.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># 1</span>
dvc<span class="w"> </span>repro

<span class="c1"># 2</span>
dvc<span class="w"> </span>dag

<span class="c1"># 3</span>
dvc<span class="w"> </span>push
</code></pre></div></td></tr></table></div>
<p>Afterwards, dvc will provide us with git files to track for our project.</p>
<h3 id="8-scheduling">8. Scheduling<a class="headerlink" href="#8-scheduling" title="Permanent link">&para;</a></h3>
<p>Scheduling our workflows can be super convenient and time-savior when we know we need to run tasks repeatedly. A very common tool for the task is cron, and here is an excellent tutorial to get started with it.</p>
<p>Note: Windows users would need to use Windows Subsystem for Linux to use cron or some other tool, potentially in PowerShell.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">HTML</span>
<span class="n">HTML</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">&lt;div align=&quot;center&quot;&gt;</span>
<span class="s2">    &lt;iframe width=&quot;700&quot; height=&quot;450&quot;</span>
<span class="s2">    src=&quot;https://www.youtube.com/embed/QZJ1drMQz1A&quot;</span>
<span class="s2">    title=&quot;YouTube video player&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; </span>
<span class="s2">    clipboard-write; encrypted-media; gyroscope; picture-in-picture; </span>
<span class="s2">    web-share&quot; allowfullscreen&gt;</span>
<span class="s2">    &lt;/iframe&gt;</span>
<span class="s2">&lt;/div&gt;</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<div align="center">
    <iframe width="700" height="450"
    src="https://www.youtube.com/embed/QZJ1drMQz1A"
    title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; 
    clipboard-write; encrypted-media; gyroscope; picture-in-picture; 
    web-share" allowfullscreen>
    </iframe>
</div>

<h3 id="9-exercises">9. Exercises<a class="headerlink" href="#9-exercises" title="Permanent link">&para;</a></h3>
<h4 id="exercise-1">Exercise 1<a class="headerlink" href="#exercise-1" title="Permanent link">&para;</a></h4>
<ol>
<li>Open the terminal, create a new directory named <code>dc_bikes</code>, and cd into it.</li>
<li>Create two subdirectories, data and src.</li>
<li>Create an ETL pipeline with two functions in the transform step.</li>
</ol>
<h4 id="exercise-2">Exercise 2<a class="headerlink" href="#exercise-2" title="Permanent link">&para;</a></h4>
<ol>
<li>Initialize a git and a dvc repository for the project in Exercise 1.</li>
<li>Create a new repo in GitHub and commit your initial changes.</li>
<li>Create a dvc pipeline with your three stages.</li>
<li>Commit your changes.</li>
</ol>
<h3 id="10-resources">10. Resources<a class="headerlink" href="#10-resources" title="Permanent link">&para;</a></h3>
<p>If you'd like to expand your knowledge around the tools and concepts that we covered in this lesson, you might find the following list of resources helpful.</p>
<ul>
<li>To learn more about pandas --&gt; <a href="https://wesmckinney.com/book/">Python for Data Analysis, 3E by Wes McKinney</a></li>
<li>To learn more about ibis --&gt; <a href="https://ibis-project.org/blog/ibis_substrait_to_duckdb/">Ibis + Substrait + DuckDB by Gil Forsyth</a></li>
<li>To learn more about duckdb --&gt; <a href="https://www.youtube.com/watch?v=AjsB6lM2-zw&amp;ab_channel=DatawithMarc">DuckDB Tutorial by Data with Marc</a></li>
<li>To learn more about dvc --&gt; <a href="https://towardsdev.com/ml-pipeline-decoupled-i-managed-to-write-a-framework-agnostic-ml-pipeline-with-dvc-rust-python-287de68104c9">ML Pipeline Decoupled: I managed to Write a Framework Agnostic ML Pipeline with DVC, Rust &amp; Python</a></li>
<li>To learn more about typer --&gt; <a href="https://towardsdatascience.com/data-and-machine-learning-model-versioning-with-dvc-34fdadd06b15">Data and Machine Learning Model Versioning with DVC by Ruben Winastwan</a></li>
<li>To learn more about cron --&gt; <a href="https://www.hostinger.com/tutorials/cron-job">Cron Job: A Comprehensive Guide for Beginners 2023 by Linas L.</a></li>
</ul>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2023 Ramon Perez
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://github.com/ramonpzg/rpg_content" target="_blank" rel="noopener" title="Github" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:ramonpzg01@gmail.com" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m20 8-8 5-8-5V6l8 5 8-5m0-2H4c-1.11 0-2 .89-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2Z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.indexes", "navigation.tabs", "navigation.instant", "content.tabs.link", "toc.follow", "navigation.top", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.b78d2936.min.js"></script>
      
    
  </body>
</html>